#!/bin/bash

dotvim_dir=$(cd "$(dirname "$0")" && pwd)
font_name=Monaco

if [ $dotvim_dir -ef ~/.vim ]; then
	echo ".vim already symlinked or is the actual dotvim repository"
else
	[ -e ~/.vim ] && rm ~/.vim
	ln -s ${dotvim_dir} ~/.vim
fi

[ -e ~/.vimrc ] && rm ~/.vimrc
[ -e ~/.gvimrc ] && rm ~/.gvimrc
ln -s .vim/vimrc ~/.vimrc
ln -s .vim/gvimrc ~/.gvimrc

font_path=$(fc-list ${font_name} file | sed "s/:.*//" | head -n 1)
font_install_path=~/.fonts/${font_name}-Powerline.otf

if [ -e `which fontforge` ] && [ -e ${font_path} ] && [ ! -e ${font_install_path} ]; then

	mkdir -p ~/.fonts
	cd ~/.fonts

	fontforge -script ~/.vim/bundle/vim-powerline/fontpatcher/fontpatcher "${font_path}"

	echo "Update font cache"
	sudo fc-cache -vf

	open ${font_install_path}

	[ -e /tmp/Powerline.cache ] && rm /tmp/Powerline.cache
fi
